# airbnb_bigdata
Instructions:
Location of Airbnb Data.
https://drive.google.com/open?id=1wIGM6btIyUdrWBAYxhv-SGaB8mwnHTj0

Download Airbnb from above site, it should contain Airbnb.zip with 193 Files for 8 different cities
Extract Airbnb.zip
Uploading Airbnb data content to HDFS Path to Airbnb Folder on local system /mnt/hgfs/Education/Bridgeport/BigData/AIRBNB 
Create a folder in hadoop file system 
hadoop fs -mkdir airbnb
Path in Hadoop fs is
 /user/training/airbnb
Command to copy Airbnb data to Hadoop file system-
hadoop fs -put /mnt/hgfs/Education/Bridgeport/BigData/AIRBNB/ /user/training/airbnb
To Check list of files uploaded:
hadoop fs  -ls /user/training/airbnb/AIRBNB/
The above command should list 8 folders which is present in AIRBNB data
One line command to extract and copy to Hadoop File system
gunzip -c ../AIRBNB.zip  | hadoop fs -put - airbnb/ 

Execute percentage count:
hadoop jar airbnb.jar solution.PercentageCount /airbnb/boston/AIRBNB/boston boston 'place_name'
Rreplace place name with userinput neighborhood 
Output File and Folder boston_out/part-r-00000
For example:
hadoop jar airbnb.jar solution.PercentageCount /airbnb/boston/s3_files/boston test Roxbury
-----------Output------------------
Entire home/apt	39.01918976545842 %
Other	0.42643923240938164 %
Private room	56.71641791044776 %
Shared room	3.837953091684435 %

Preprocessing data before loading into Hive:
We can directly upload airbnb files to Hive , but number of columns vary from one file to another file which cannot be loaded into single table and we need to create 193 tables for each file, we need to preprocess all files and have common csv file to load into hive
We could use simple java/python programs to pre process all files and generate a single file which contains unique number of columns, since its big data traditional approach won't be suited, we can use Map Reduce program to generate this file 
hadoop jar airbnb.jar hive.HivePreporcess /airbnb/ output
The new processed file contains 6 columns which are described below
fileName :- name of the file which contains this record (STRING)
neighbourhood:- name of the neighbourhood (STRING) 
roomId:- room Id  (INT)
reviews:- total no of reviews (INT) 
overall_statisfaction:- rating of the room (FLOAT)
City:- city (STRING) 
filedate:- data when the file was generated by airbnb(TIMESTAMP)


Command to create hive table for above csv file is type hive in terminal 
TO CREATE DATABASE
hive> create database airbnb;
hive> use airbnb;

TO CREATE A TABLE
hive> CREATE EXTERNAL TABLE airbnb ( fileName STRING, neigh STRING, room_id INT, reviews INT, over_all FLOAT,city STRING, procesed_date TIMESTAMP) row format delimited fields terminated by ',' STORED AS TEXTFILE;
TO DESCRIBE
hive> describe airbnb;
-----------Output------------------
OK
filename	string	
neigh	string	
room_id	int	
reviews	int	
over_all	float	
city	string	
procesed_date	timestamp	
Time taken: 0.327 seconds

TO LOAD FROM  PATH
hive> LOAD DATA  INPATH '/user/training/airbnb/output/part-r-00000' OVERWRITE INTO TABLE airbnb;

TO check no of contents 
hive> select count(*) from airbnb;
-----------Output------------------
OK
2376013
Time taken: 327.363 seconds


TO CHECK FIRST 5 RECORDS
hive> select * from airbnb limit 5;
-----------Output------------------
OK
tomslee_airbnb_boston_0054_2014-09-24.csv		Jamaica Plain 	5453	53	5.0	 boston 	2014-09-24 00:00:00
tomslee_airbnb_boston_0054_2014-09-24.csv		Roxbury 	5506	30	4.5	 boston 	2014-09-24 00:00:00
tomslee_airbnb_boston_0054_2014-09-24.csv		Roxbury 	6695	39	5.0	 boston 	2014-09-24 00:00:00
tomslee_airbnb_boston_0054_2014-09-24.csv		Roslindale 	6976	26	5.0	 boston 	2014-09-24 00:00:00
tomslee_airbnb_boston_0054_2014-09-24.csv		Downtown 	8789	1	5.0	 boston 	2014-09-24 00:00:00
Time taken: 0.231 seconds

TO LOAD FROM  PATH
hive> LOAD DATA  INPATH '/user/training/airbnb/part-r-00000' OVERWRITE INTO TABLE airbnb1;
TO GET ALL ROOMS AND NEIGHBOURHOOD USING GROUP BY AND ORDER BY 
hive> select room_id, neigh, SUM(reviews), AVG(over_all) as overall from airbnb where city like "%boston%"  GROUP BY room_id,neigh ORDER BY overall DESC limit 10;
-----------Output------------------
Total MapReduce CPU Time Spent: 4 minutes 9 seconds 580 msec
OK
5918205		North End 	12	5.0
5709298		Beacon Hill 	2876	5.0
5709298		West End 	138	5.0
5709447		Brighton 	20	5.0
5916419		Downtown 	3	5.0
133158		South End 	25	5.0
5903663		Mission Hill 	1	5.0
5903011		Charlestown 	1	5.0
5891012		Dorchester 	41	5.0
5889190		Allston 	1115	5.0
Time taken: 433.797 seconds

USING JOIN 
hive> SELECT DISTINCT a.room_id,b.neigh,a.sum_reviews,a.avg_overall_satisfaction
FROM
(SELECT room_id,SUM(reviews) as sum_reviews,AVG(over_all) as avg_overall_satisfaction FROM airbnb WHERE city like "%boston%" GROUP BY room_id) a
JOIN
(SELECT room_id,neigh from airbnb) b
on a.room_id=b.room_id
ORDER BY avg_overall_satisfaction,sum_reviews DESC;
---------------Output-----------------------------
1262443		Dorchester 	21	NULL
11796879		South End 	12	NULL
10253416		Allston 	11	NULL
8312163		Allston 	10	NULL
4662140		Back Bay 	10	NULL
12026868		Allston 	9	NULL
9504314		Back Bay 	8	NULL
9791506		Jamaica Plain 	8	NULL
13550412		Allston 	8	NULL
13697486		Jamaica Plain 	8	NULL
12971157		East Boston 	8	NULL
